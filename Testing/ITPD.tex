% !TEX TS-program = pdflatex
% !TEX encoding = UTF-8 Unicode

% This is a simple template for a LaTeX document using the "article" class.
% See "book", "report", "letter" for other types of document.

\documentclass[11pt]{article} % use larger type; default would be 10pt.
\setcounter{secnumdepth}{2}

\usepackage{paralist} % very flexible & customisable lists (eg. enumerate/itemize, etc.)

\usepackage[utf8]{inputenc} % set input encoding (not needed with XeLaTeX)
\usepackage{float} % to place float images correctly
\usepackage{color} % to color text
\usepackage{enumitem} % for lists
\usepackage{subfigure} % for mockups
\usepackage[font={it}]{caption} % for captions

%%% Examples of Article customizations
% These packages are optional, depending whether you want the features they provide.
% See the LaTeX Companion or other references for full information.

%%% PAGE DIMENSIONS
\usepackage{geometry} % to change the page dimensions
\geometry{a4paper} % or letterpaper (US) or a5paper or....
% \geometry{margin=2in} % for example, change the margins to 2 inches all round
% \geometry{landscape} % set up the page for landscape
%   read geometry.pdf for detailed page layout information

\usepackage{graphicx} % support the \includegraphics command and options

% \usepackage[parfill]{parskip} % Activate to begin paragraphs with an empty line rather than an indent

\usepackage{listings}
\usepackage{color}
 
\definecolor{codegreen}{rgb}{0,0.4,0}
\definecolor{codegray}{rgb}{0.5,0.5,0.5}
\definecolor{codepurple}{rgb}{0.58,0,0.82}
 
\lstdefinestyle{mystyle}{ 
    commentstyle=\color{magenta},
    keywordstyle=\color{blue}\bfseries,
    numberstyle=\tiny\color{codegray},
    stringstyle=\color{codepurple},
    basicstyle=\footnotesize,
    breakatwhitespace=false,         
    breaklines=true,                 
    captionpos=b,                    
    keepspaces=true,                 
    numbers=left,                    
    numbersep=5pt,                  
    showspaces=false,                
    showstringspaces=false,
    showtabs=false,                  
    tabsize=2,
   emph={self}, 
   emphstyle=\color{blue}, 
   emph={[2] BookingManager, FineManager}, 
   emphstyle=[2]\color{codegreen}\bfseries, 
   emph={[3]__init__, newBook, removeReservation, getReservation, manageExpired, min_heap, pop, now, timedelta, expireReservation}, 
   emphstyle=[3]\color{codegreen}, 
}
 
\lstset{style=mystyle}





%%% PACKAGES
\usepackage{booktabs} % for much better looking tables
\usepackage{array} % for better arrays (eg matrices) in maths
%\usepackage{paralist} % very flexible & customisable lists (eg. enumerate/itemize, etc.)
\usepackage{verbatim} % adds environment for commenting out blocks of text & for better verbatim
\usepackage{subfig} % make it possible to include more than one captioned figure/table in a single float
% These packages are all incorporated in the memoir class to one degree or another...

%%% HEADERS & FOOTERS
\usepackage{fancyhdr} % This should be set AFTER setting up the page geometry
\pagestyle{fancy} % options: empty , plain , fancy
\renewcommand{\headrulewidth}{0pt} % customise the layout...
\lhead{}\chead{}\rhead{}
\lfoot{}\cfoot{\thepage}\rfoot{}

%%% SECTION TITLE APPEARANCE
\usepackage{sectsty}
\allsectionsfont{\sffamily\mdseries\upshape} % (See the fntguide.pdf for font help)
% (This matches ConTeXt defaults)

%%% ToC (table of contents) APPEARANCE
\usepackage[nottoc,notlof,notlot]{tocbibind} % Put the bibliography in the ToC
\usepackage[titles,subfigure]{tocloft} % Alter the style of the Table of Contents
\renewcommand{\cftsecfont}{\rmfamily\mdseries\upshape}
\renewcommand{\cftsecpagefont}{\rmfamily\mdseries\upshape} % No bold!

\newcommand{\pe}{PowerEnJoy }
\newcommand{\pecomma}{PowerEnJoy, }
\newcommand{\bul}[1]{\indent$\bullet$ #1\\}

\newcommand{\toBeIntegrated}[4]{
\begin{description}
	\item[Component1]: #1
	\item[Component2]: #2
	\item[Functionality]: #3
	\item[Description]: #4
\end{description}}

\newcommand{\toBeIntegratedThree}[5]{
\begin{description}
	\item[Component1]: #1
	\item[Component2]: #2
	\item[Component3]: #3
	\item[Functionality]: #4
	\item[Description]: #5
\end{description}}

\newcommand{\toBeIntegratedFour}[6]{
\begin{description}
	\item[Component1]: #1
	\item[Component2]: #2
	\item[Component3]: #3
	\item[Component4:] #4
	\item[Functionality]: #5
	\item[Description]: #6
\end{description}}



\usepackage{listings}
\usepackage{pxfonts}
\usepackage{enumitem}

\newcounter{IntegrationTest}
\newenvironment{test}[1][]{
	\refstepcounter{IntegrationTest}
	\item[Integration] IT {\ifnum\value{IntegrationTest}<10 0\fi \theIntegrationTest}
	\begin{enumerate} #1}{
	\end{enumerate}}

\newcommand{\testCase}[6]{
\item  \textbf{Test Case ID: IT{\ifnum\value{IntegrationTest}<10 0\fi \theIntegrationTest}C{\theenumi} }
\begin{description}
	\item[Test Items:] {#1}
	\item[Input Specification:] {#2}
	\item[Environment State:] {#3}
	\item[Output Specification:] {#4}
	\item[Purpose:] {#5}
	\item[Dependencies:] {#6}
\end{description} 
\hfill  
}


\def\twodigits#1{%
  \ifnum#1<10 0\fi
  \number#1}



%%% END Article customizations

%%% The "real" document content comes below...




\title{Integration	Test Plan Document}
\author{Simone Mosciatti \& Sara Zanzottera}

\begin{document}


\begin{titlepage}

\newcommand{\HRule}{\rule{\linewidth}{0.5mm}} % Defines a new command for the horizontal lines, change thickness here
\center % Center everything on the page

%	LOGO SECTION
\includegraphics[width=10cm]{../DOC/polimiLogoNome.png}\\[0.5cm] % Include a department/university logo
 
%	HEADING SECTIONS
%\textsc{\Large Politecnico di Milano}\\[1cm] % Name of your university/college
%\textsc{\large Software Engineering II} \\
%\textsc{\large A. Y. 2016/2017}


%	TITLE SECTION
%\HRule \\[0.4cm]
\\[2cm]
{ \Huge \bfseries \pe} \\[0.5cm] % Title of your document
{ \LARGE \bfseries Integration Test Plan Document} \\[0.5cm]
{\large Version 1.1}
\\[2cm] 
%\HRule \\[1.5cm]

%	AUTHOR SECTION
\Large \emph{Authors:}\\
{\Large \textsc{Mosciatti}} Simone\\ % Your name
{\Large \textsc{Zanzottera}} Sara\\
\\[1cm]
\emph{Reference Professor:} \\
{\Large \textsc{Mottola}} Luca % Supervisor's Name

\vfill % Fill the rest of the page with whitespace

%	DATE SECTION
{\large January 15, 2017}% Date, change the \today to a set date if you want to be precise

\end{titlepage}


\newpage
\tableofcontents
\newpage


\section{Introduction}

\subsection{Purpose}

This document aims to explain to the development team how to deploy the integration test for \pecomma the sequence of tests to be performed, their entry criteria and their expected outcome. 

The tests refers sttrictly to the components described in the Design Document, and test results should be evaluated referring to the Requirement Analysis and Specification Document. Integration tests evaluate not the internal structure of subcomponents, but simply their interfaces and behavior.

We also specify the strategy to be followed concerning how to provide test data, the required testing equipment, the deploying strategy for new releases, continuous integration and the hardware emulation of the car's hardware system, providing the rationale behind our choice.

\subsection{Scope}

\pe is a digital management system for car sharing that exclusively employs electric cars to provide its service. The system provides all the functionalities normally provided by a car sharing service: registering to the service, find the location of nearby available cars, reserve cars up to a short amount of time, unlock the chosen car once found, ride it and then park it in a safe area, when it will be automatically locked and the fee paid.

In addition, the system gives bonuses and penalities in term of discounts or overprices depending on the behavior of the user, in order to promote virtuous behaviors.

\pe is therefore a inherently distributed system, based on a central server interactions with many distributed nodes. All these components will be examined in more detail in the subsequent sections of the document.


\subsection{Definitions, Acronyms, Abbreviations}
 \begin{description}
	\item[RASD] Requirements and Specification Document.
	\item[DD] Design Document.
	\item[User] A customer of \pe using the service.
	\item[Staff Operator (Operator)] An employee of \pe which takes care of the cars.
	\item[Ride] The action of getting onboard of a \pe car, start its engine, drive to destination and park.
	\item[Issue] Any problem a car may incur in, or a user may face while using the service.
	\item[Nearby Cars] Available cars located within a maximum distance to a specific position.
	\item[Available Cars] Cars whose Availability Status is set to ``Available``.
	\item[Nearby Issues] Issues that are affecting cars close to a specific position.
	\item[Booking (Reservation)] The act to reserve a car for a limited amount of time for future use by a user.
	\item[Driver] Whoever is driving a regularly booked \pe car.
	\item[Driving License] The state's issued driving license of the user.
	\item[Notification] A form of comunication where the user is actively notified of some event.
	\item[Issue Report] An incoming notification that states a car incurred in an issue.
	\item[Fine] A fine issued by the local law enforcing officers to a user while driving a \pe car. 
	\item[Pending Bills] Bills that an user still need to pay to \pe.
	\item[Safe Area] An parking area, predefined by the company, where is possible to safely park the cars of the \pe fleet.
	\item[Battery Charge] The amount of charge that is kept inside the car's battery.
	\item[Charging Station (Power Station)] Dedicated areas where is possible to plug the \pe cars to charge their batteries.
	\item[Car's Onboard System] The controll system of the car that is able to exchange data with the central system and to relevate operation parameters.
	\item[Customer's App] An implementation of the system frontend tailored to the need of the customers.
	\item[Staff's App] An implementation of the system frontend tailored to the need of the staff.
	\item[Central System (Main Server)] The central system for \pe. All the command and all the data are streamed, analyzed and used here.
	\item[GPS]: Global Positioning System is a global navigation satellite system (GNSS) that provides location and time information in all weather conditions, anywhere on or near the Earth where there is an unobstructed line of sight to four or more GPS satellites.
	\item[Location] Pair of integer values as provided by GPS sensors.
	\item[Payment Method] Set of data relative to a credit card.
	\item[Email address (Email)] Unique string identifiying an email box to which email messages are delivered.
	\item[Identity ID] Personal code provided by local authorities to uniquely identify citizens.
	\item[Driving License ID] The unique code reported on every legal driving license.
	\item[Session Key]  A string representing a key for a secured channel. Used to secure communications between the server and the nodes.
	\item[Scanned License] An high quality image of the driving license acquired by the car's onboard system.
  \end{description}

\subsection{Reference Documents}
\begin{itemize}
	\item \textit{Assignments AA 2016-2017.pdf} (Assignments document given by the teacher)
	\item \textit{Requirements And Specification Document} (referring to this project)
	\item \textit{Design Document} (referring to this project)
	\item \textit{Integration Test Plan Example.pdf}
  \end{itemize}



\newpage
\section{Integration Strategy}

We believe that the integration of different components should not be a completely different phase from the development of each component.

Integration should happen as soon as possible even with mock implementation of the components. Such early integration helps in identifying possible inconsistencies in the design documents: the sooner those inconsistencies are discovered, the simpler it is to fix them.

\subsection{Entry criteria}

As long as the integration tests are automatic and fast, we do not advocate for any strong or specific precondition.

On the other side we advocate to run the integration test after each commit. This procedure helps in catching regressions as early as possible.

Unit tests should be used in order to guarantee the interface exposed and documented are respected, and that the component runs in isolation, fulfilling its assigned functionalities.

\subsection{Elements to be integrated}

All the components that interact with the user must be integrated with the User FrontEnd. Similarly all the components that need to interact with the Staff need to be integrated with the Staff FrontEnd.

Also, the GEOLOCATION component needs to be integrated with the Car GUI.

Concerning external services, only a few components need to interact with them. In particular we need to integrate the BILLING\_SYSTEM, POSITION, GEOLOCATION, USER\_MANAGER with external services.

Finally, only a few services must be integrated between each other in the system, thanks to the high degree of decoupling reached during the design phase.

The services that must be integrated inside the system are the following:

\begin{enumerate}[label={\textbf{IT\protect\twodigits{\theenumi}}},leftmargin=*]
\item \hfill
\toBeIntegrated
	{GEOLOCATION}
	{POSITION}
	{GEOLOCATION/AvailableCar}
	{The position of each car, retrieved using POSITION/Car, is used in order to describe which cars are close to a specific position.}

\item \hfill
\toBeIntegratedThree
	{GEOLOCATION}
	{POSITION}
	{CAR\_MANAGER}
	{GEOLOCATION/Issues}
	{The position of each car, retrieved using POSITION/Car, that has some issues (detectable using CAR/Telemetry) is used to communicate to the staff where are cars that need their intervent.}

\item \hfill
\toBeIntegrated
	{RIDE\_MANAGER}
	{CAR\_MANAGER}
	{RIDE/Start, RIDE/End}
	{When a ride starts (ends), detected using CAR/Telemetry, the RIDE/Start (RIDE/End) method is invoked.}

\item \hfill
\toBeIntegrated
	{BILLING\_MANAGER}
	{CAR\_MANAGER}
	{BILL/Pay}
	{When the car is locked, the payment procedure of the user starts.}

\item \hfill
\toBeIntegrated
	{BILLING\_MANAGER}
	{BOOKING\_MANAGER}
	{BILL/CalculateExpireBookFee}
	{When a booking expires, detected using BOOKING/Expire, the user should be asked to pay the fee calculated using BILL/CalculateExpireBookFee}
	
\item \hfill
\toBeIntegratedFour
	{BILLING\_MANAGER}
	{RIDE\_MANAGER}
	{POSITION}
	{GEOLOCATION}
	{BILL/CalculateUnsafeParkingFine}
	{When the user ends a ride, detected using RIDE/End, and the car is unsafely parked, detected using POSITION/Car and GEOLOCATION/IsSafeArea, the user is prompted to pay for the ride plus the fee for having parked the car in an unsafe position.}
	
\item \hfill
\toBeIntegrated
	{BILLING\_MANAGER}
	{CAR\_MANAGER}
	{BILL/CalculateRideFee}
	{After a ride is concluded, the amount of the fee the user is prompted to pay is determinated on the base of several bonuses that may be applied. To determinate which bonuses apply, CAR/Telemetry is used.}

\end{enumerate}




\subsection{Integration testing strategy}

We chosed, basically, to implement a bottom-up approach to our integration testing strategy. 

Actually, the only components that requires a sub-components integration are the three services that are physically distributed. Once integrate, we can proceed to a higher-level integration reasoning about them in terms of a simpler logical component.

\begin{enumerate}
	\item CAR\_MANAGER: this component needs its own integration. It is distributed between the car system and the main server; it is also the only components that touches the hardware side of the project. In our opinion it should be the first component to be integrated.
	\item ISSUE\_MANAGER: another component that needs its own integration. However its functionality is more bounded that the one provided by CAR\_MANAGER.
	\item POSITION: this component needs it own integration too. However, its functionality is pretty standard and well known.
\end{enumerate}

In parallel we can proced to integrate the external services with our own high-level components, namely BILLING\_SYSTEM , POSITION , GEOLOCATION,  and  USER\_MANAGER.

\subsection{Sequence of components integration}

Our design tried to keep the components very decoupled. This gives us a lot of flexibility in the integration process.

There are not hard constraints in what component should be integrated first, as long as sub-components get integrated into higher-level components before proceeding with the integration of high-level ones.

Of course all the components needs to be integrated with the user interface. We are not showing all those integrations, that are extremely simple but necessary. Since the NOTIFIER components is part of the user interface, we are not showing the integrations that concern this component.

Before going deeply inside the description of the high-level integrations, we describe the sub-component integrations required.

\begin{figure}[H]
	\centering
	\includegraphics[width=1\textwidth]{UML/IntegrationDistributedComponents.png}
	\caption{Sub-components integration regarding physically splitted components into a single, high-level logical component.}
\end{figure}	

In the following diagram we show what components integrates with others.

There are not strict dependencies: it is more a net that a pyramid.

\begin{figure}[H]
	\centering
	\includegraphics[width=1\textwidth]{UML/IntegrationStrategy.png}
	\caption{Integration net}
\end{figure}	


\newpage
\section{Individual Steps and Tests Description}

In this section we describe what test are necessary for each integration.

For each integration we list and describe the most important tests.

\begin{description}
	\begin{test}
		\testCase{GEOLOCATION $\rightarrow$ POSITION}
			{A circle including the point A is submitted to GEOLOCATION/AvailableCar}
			{An available car is located at coordinates A}
			{A list of cars including the car located in A}
			{Verify the output given by GEOLOCATION/AvailableCar in case of at least one car available in the selected area}
			{Unit tests for GEOLOCATION and POSITION}
		\testCase
			{GEOLOCATION $\rightarrow$ POSITION}
			{A circle centered in C with radius equal or less than R is submitted to GEOLOCATION/AvailableCar}
			{No cars are available into the circle centered in C with radius R}
			{An empty list}
			{Verify the output given by GEOLOCATION/AvailableCar in case of no cars available in the selected area}
			{Unit tests for GEOLOCATION and POSITION}
	\end{test}

	\begin{test}
		\testCase
			{GEOLOCATION $\rightarrow$ POSITION $\leftarrow$ CAR\_MANAGER}
			{A circle including the point A is submitted to GEOLOCATION/Issue}
			{A car with an issue is located at coordinates A}
			{A list of cars including the car located in A}
			{Verify the output given by GEOLOCATION/Issue in case of at least one car issued in the selected area}
			{Unit tests for GEOLOCATION, POSITION and CAR\_MANAGER}
		\testCase
			{GEOLOCATION $\rightarrow$ POSITION $\leftarrow$ CAR\_MANAGER}
			{A circle centered in C with radius equal or less than R is submitted to GEOLOCATION/Issue}
			{No cars with issues are located into the circle centered in C with radius R}
			{An empty list}
			{Verify the output given by GEOLOCATION/Issue in case of no cars with issues present in the selected area}
			{Unit tests for GEOLOCATION, POSITION and CAR\_MANAGER}
	\end{test}

	\begin{test}
		\testCase
			{CAR\_MANAGER $\rightarrow$ RIDE\_MANAGER}
			{The signal meaning that the engine ignited is sent to CAR\_MANAGER}
			{All the precondition for a ride to start are fulfilled (a non-expider booking exist for that car, the driver scanned successfully the correct driving licence, etc) }
			{A Ride is started successfully.}
			{Verify the behavior of RIDE/Start}
			{Unit tests for CAR\_MANAGER and RIDE\_MANAGER}

		\testCase
			{CAR\_MANAGER $\rightarrow$ RIDE\_MANAGER}
			{The signal meaning that the driver exited is sent to CAR\_MANAGER}
			{A ride for that car is open.}
			{The relative ride is closed successfully}
			{Verify the behavior of RIDE/End}
			{IT03C1 and unit tests for CAR\_MANAGER and RIDE\_MANAGER}
	\end{test}

	\begin{test}
		\testCase
			{CAR\_MANAGER $\rightarrow$ BILLING\_MANAGER}
			{The locking signal is received by CAR\_MANAGER}
			{A ride for that car exist and is closed.}
			{The payment procedure starts.}
			{Verify that after the locking signal has been sent, the payment procedure starts immediately.}
			{IT03C2 and unit tests for CAR\_MANAGER and BILLING\_MANAGER}
	\end{test}

	\begin{test}
		\testCase
			{BOOKING\_MANAGER $\rightarrow$ BILLING\_MANAGER}
			{A reservation expires.}
			{A reservation exist, but no rides are related to it.}
			{The fine for the expired booking is calculated and the payment procedure starts.}
			{Verify that when a reservation expires, the correct fine is calculated and the payment procedure starts.}
			{Unit tests for BOOKING\_MANAGER and BILLING\_MANAGER}
	\end{test}

	\begin{test}
		\testCase
			{\{GEOLOCATION $\rightarrow$ POSITION \} $\leftarrow$ RIDE\_MANAGER $\rightarrow$ BILLING\_MANAGER}
			{A ride ends.}
			{The car whose ride is ending is located outside from a safe area.}
			{The fine for the unsafe parking is calculated and the payment procedure starts.}
			{Verify that when a car is parked outside from a safe area, the correct fine is calculated and the payment procedure starts.}
			{IT03C2 and unit tests for GEOLOCATION, POSITION, RIDE\_MANAGER and BILLING\_MANAGER}
	\end{test}

	\begin{test}
		\testCase
			{CAR\_MANAGER $\rightarrow$ BILLING\_MANAGER}
			{A car is locked.}
			{A ride and a booking exsist relative to that car and the user who locked it.}
			{The fee is calculated and the payment procedure starts.}
			{Verify that when a car is locked, the correct fee is calculated and the payment procedure starts.}
			{IT03C2 (which is an included procedure) and unit tests for CAR\_MANAGER and BILLING\_MANAGER}
	\end{test}

\end{description}

These tests are to be considered as guidelines. We described only the most straightforward test that must be implemented; however, other tests can be deployed too.

Usually it is a good idea to test not only that a method is invoked and used, but also that a method is not being invoked. We do not specifically describe those tests because they are extremely implementation dependent. 

Developers should take into consideration if such kind of tests are useful during the testing phase, and if necessary, implement them.



\newpage
\section{Tools and Test Equipment Required}

Any tools or framework works just as well in this project: our suggestion is to use a well know libraries and framework.

A very reasonable choice is \textbf{JUnit4}, which is the default testing framework for Java application.

\subsection{Continuos Integration and Unit Testing}

A server of continuos integration is necessary in order to execute the integration tests and the unit tests after each commit to the main code base.

Each developer should still be able to run every test in its developing machine.

The unit test suite is expected to be extremelly fast so that it can be executed at will by every developer without slowing down their workflow.

For the integration test, we don't require them to be fast, although is still a very desiderable property. But they should be, at very least, completely automatic.

\subsection{Testing Strategy}

We do not advocate for rigid methodology. Test should be produced in order to avoid regression. 

After fixing a bug, a test relative to that same bug should be put in place and should be continuosly run.

\subsection{Deploying}

The deploy of the whole architecture should require the least amount of steps possible, ideally just one.

Considering the application is serving live traffic, a deploy of a new version should be done following the incremental GREEN / BLUE methodology: start running the new software only a small fraction of the overall traffic to the new version and, if everything on the control metrics still looks fine, increase the amount of traffic redirected to the new version until reaching the totality. Immediately roll back to the previous version at the first sign of problems.

\newpage
\section{Program Stubs and Test Data Required}

\subsection{Stubs}

At this time, no stubs are strictly required to run our integration test suite.

Concerning the integration of our system with external services, we noticed that most interactions can be covered with the unit tests of single components: even in these cases, stubs are not required as all our external services expose some specific testing APIs that can be used for this purpose.

\subsection{Test Data}

The necessary test data will be generated using ad-hoc software.

There should be two different databases: one for tests and another for production. If it is necessary to simulate the load of the production database, we will not directly use it, but we populate the test database.

\subsection{Hardware Emulation}

Running integration tests using a real car may be difficult. That's why an emulation environment for the car's onboard system should be enough to run all our integration tests: this solution makes running tests faster and easier. 

Also, the developing time of the hardware is usualy longer than the developing time of software, and relying on the actual hardware for running integration test may lead to delays or to skip the run of fundamental integration tests: a situation we would prefer to avoid.


\newpage
\section{Conclusions}

\subsection{Tools used}
During the development of this document we used the following tools:
\begin{itemize}
	\item \textbf{Github} to version control the project
	\item \textbf{\LaTeX} on TeXworks to redact this document
\end{itemize}

\subsection{Hours of work}
\begin{itemize}
	\item SZ: 1h on 21/12
	\item SM: 3h on 23/12
	\item SM: 5h on 27/12
	\item SM: 4h on 3/01
	\item SM: 6h on 7/01
	\item SZ: 2h on 11/01
	\item SZ: 3h on 14/01
	\item SM: 1h on 15/01
\end{itemize}

\subsection{Changelog}
\begin{itemize}
	\item v.1.1:
		\begin{itemize}
			\item{Add a cover page}
		\end{itemize}
\end{itemize}




\end{document}  
